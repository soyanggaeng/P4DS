<!DOCTYPE html>
<html>
<head>
    <title>YAMP: Youtube Ad Matching Platform - Proposal</title>
    <link rel="stylesheet" type="text/css" href="static/css/styles.css">
    <script type="text/javascript" src="static/js/common.js"></script>
    <script type="text/javascript" src="static/js/login.js"></script>
    <script type="text/javascript" src="static/js/user.js"></script>
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>
<body>
    <header>
        <script>
            h1 = "Channel Proposal"
            h3 = "Recommendation and Submission"
        </script>
    </header>

    <nav>
        <div class="login-button-container">
            <a href="#" id="logout-button">Log Out</a>
        </div>
    </nav>
    
    <section id="proposal-recommendation">
        <h2>Channel Recommendation</h2>
        <p>Based on your budget and the product to be advertised, we have identified the YouTube channels that would be most effective for your advertising campaign:</p>
        <!-- Include the channel recommendations here -->
        <form id="recommend-form", method="post">            
            <label for="product">Product:</label>
            <select id="product" name="product" required>
                <option value="" disabled selected>Select Product Type</option>
                <option value="technology">Technology</option>
                <option value="gaming">Gaming</option>
                <option value="beauty-fashion">Beauty and Fashion</option>
                <option value="food-beverage">Food and Beverage</option>
                <option value="health-fitness">Health and Fitness</option>
                <option value="travel-tourism">Travel and Tourism</option>
                <option value="automotive">Automotive</option>
                <option value="entertainment-media">Entertainment and Media</option>
                <option value="home-lifestyle">Home and Lifestyle</option>
                <option value="financial-services">Financial Services</option>
            </select>
            
            <label for="budget">Budget:</label>
            <input type="number" id="budget" name="budget" placeholder="Enter Budget Amount" required>
            
            <label for="keywords">Keywords:</label>
            <div id="keyword-container">
                <input type="text" id="keyword-0" name="keywords[]" placeholder="Enter Your Keyword" required>
                <div id="suggestions"></div> <!-- Suggestions container -->
            </div>
            <button type="button" id="add-keyword">+</button>

          
            <input type="submit" value="Get Recommendations">
        </form>
        <div id="recommendations">
            <div id="chart"></div>
        </div>        
    </section>
    
    <section id="proposal-submission">
        <h2>Proposal Submission</h2>
        <p>Send a proposal to the recommended YouTubers through our YAMP service:</p>
        <form id="proposal-form" action="/updateProposal", method="post">
            <label for="youtuber-name">YouTuber Name:</label>
            <input type="text" id="youtuber-name" name="youtuber-name" placeholder="Recommended YouTuber's Name" required readonly>
            
            <label for="contact-email">Contact Email:</label>
            <input type="email" id="contact-email" name="contact-email" placeholder="Recommended YouTuber's Email Address" required readonly>

            <label for="timeline">Timeline:</label>
            <input type="text" id="timeline" name="timeline" placeholder="Proposed Timeline" required>
            
            <label for="message">Message:</label>
            <textarea id="message" name="message" placeholder="Enter Your Proposal Message" required></textarea>

            <input type="hidden" id="hidden-product" name="product">
            <input type="hidden" id="hidden-budget" name="budget">
            
            <input type="submit" value="Send Proposal">
        </form>        
    </section>
    
    <footer>
    </footer>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var keywordContainer = document.getElementById("keyword-container");
            var suggestionsContainer = document.getElementById("suggestions");
            var keywordInputs = keywordContainer.getElementsByTagName("input");
    
            // Add event listeners for keyword inputs
            for (var i = 0; i < keywordInputs.length; i++) {
                keywordInputs[i].addEventListener("input", function() {
                    var keyword = this.value;
                    showSuggestions(keyword);
                });
            }
    
            function showSuggestions(keyword) {
                // Clear previous suggestions
                suggestionsContainer.innerHTML = "";
    
                // Generate suggestions based on keyword
                if (keyword.trim() !== "") {
                    var productType = document.getElementById("product").value;
                    var exampleKeywords = getExampleKeywords(productType);
                    var filteredKeywords = exampleKeywords.filter(function(exampleKeyword) {
                        return exampleKeyword.toLowerCase().startsWith(keyword.toLowerCase());
                    });
    
                    // Display suggestions
                    filteredKeywords.forEach(function(filteredKeyword) {
                        var suggestion = document.createElement("div");
                        suggestion.textContent = filteredKeyword;
                        suggestion.addEventListener("click", function() {
                            var keywordInput = document.activeElement;
                            keywordInput.value = this.textContent;
                            suggestionsContainer.innerHTML = "";
                        });
                        suggestionsContainer.appendChild(suggestion);
                    });
                }
            }
    
            function getExampleKeywords(productType) {
                var exampleKeywords = [];
                switch (productType) {
                    case "technology":
                        exampleKeywords = ["스마트폰", "컴퓨터", "인터넷", "IT", "디지털"];
                        break;
                    case "gaming":
                        exampleKeywords = ["게임", "오버워치", "리그오브레전드", "마인크래프트", "롤"];
                        break;
                    case "beauty-fashion":
                        exampleKeywords = ["화장품", "패션", "뷰티", "메이크업", "스타일"];
                        break;
                    case "food-beverage":
                        exampleKeywords = ["음식", "요리", "음료", "레시피", "식품"];
                        break;
                    case "health-fitness":
                        exampleKeywords = ["건강", "운동", "다이어트", "피트니스", "웰빙"];
                        break;
                    case "travel-tourism":
                        exampleKeywords = ["여행", "관광", "해외여행", "국내여행", "여행팁"];
                        break;
                    case "automotive":
                        exampleKeywords = ["자동차", "차량", "자동차리뷰", "자동차정비", "자동차운전"];
                        break;
                    case "entertainment-media":
                        exampleKeywords = ["엔터테인먼트", "영화", "드라마", "연예인", "미디어"];
                        break;
                    case "home-lifestyle":
                        exampleKeywords = ["가정", "인테리어", "라이프스타일", "가구", "홈케어"];
                        break;
                    case "financial-services":
                        exampleKeywords = ["금융", "재테크", "보험", "은행", "금융상품"];
                        break;
                    default:
                        break;
                }
                return exampleKeywords;
            }
    
            document.getElementById("add-keyword").addEventListener("click", function() {
                if (keywordInputs.length < 3) {
                    var newKeywordInput = document.createElement("input");
                    newKeywordInput.type = "text";
                    newKeywordInput.name = "keywords[]";
                    newKeywordInput.placeholder = "Enter Your Keyword";
                    newKeywordInput.required = true;
                    keywordContainer.appendChild(newKeywordInput);
                }
            });
        });
    
        var database;
    
        window.addEventListener('load', function () {
            communicate('/getYoutuberInfo', {})
                .then(data => {
                    database = data;
                });
            }
        )
    
        var currentDatetime = new Date();
        var currentDatetimeString = currentDatetime.toLocaleString('en-US');
        $("#timeline").value = currentDatetimeString;
    
        $('#proposal-form').addEventListener('submit', function() {
            // copy product value
            $('#hidden-product').value = $('#product').value;
    
            // copy budget value
            $('#hidden-budget').value = $('#budget').value;;
        });
    
    
        $('#recommend-form').addEventListener('submit', function(e) {
            e.preventDefault(); // Prevent default form submission
    
            var formData = new FormData(this); // Get form data
    
            // Perform AJAX request using Fetch API
            fetch('/getRecommendedChannels', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                var Youtubers = database.filter(item => data.includes(item.title));
    
                if (Youtubers.length > 0) {
                    $('#recommendations').innerHTML = ''; // Clear previous search results
    
                    for (var i = 0; i < Youtubers.length; i++) {
                        var channelItem = document.createElement('div');
                        channelItem.classList.add('channel-item');
    
                        channelItem.dataset.title = Youtubers[i].title;
                        channelItem.dataset.mails = Youtubers[i].mails;
    
                        var thumbnail = document.createElement('img');
                        thumbnail.src = Youtubers[i].thumbnails;
                        thumbnail.alt = Youtubers[i].youtuber;
                        channelItem.appendChild(thumbnail);
    
                        var channelInfo = document.createElement('div');
                        channelInfo.classList.add('channel-info');
    
                        var youtuberName = document.createElement('h3');
                        youtuberName.textContent = Youtubers[i].title;
                        channelInfo.appendChild(youtuberName);
    
                        var subscriberCount = document.createElement('p');
                        subscriberCount.textContent = 'Subscriber Count: ' + Youtubers[i].subscriberCount;
                        channelInfo.appendChild(subscriberCount);
    
                        var subscriberChange = document.createElement('p');
                        subscriberChange.textContent = 'Subscriber Change: ' + Youtubers[i].subscriberChange;
                        channelInfo.appendChild(subscriberChange);
    
                        var dailyViewCount = document.createElement('p');
                        dailyViewCount.textContent = 'Daily View Count: ' + Youtubers[i].dailyViewCount;
                        channelInfo.appendChild(dailyViewCount);
    
                        var description = document.createElement('p');
                        description.textContent = Youtubers[i].description;
                        channelInfo.appendChild(description);
    
                        channelItem.appendChild(channelInfo);
                        $('#recommendations').appendChild(channelItem);
    
                        channelItem.addEventListener('click', function() {
                            document.getElementById("youtuber-name").value = this.dataset.title;
                            document.getElementById("contact-email").value = this.dataset.mails;
                        });
                    }
                } else {
                    $('#recommendations').innerHTML = '<p>No results found.</p>';
                }
    
            })
        });
    
    
    
        function searchYouTuber(youtuberName) {
            var contactEmail = document.getElementById("contact-email");
            var foundYoutuber = database.find(function(youtuber) {
                return youtuber.title.toLowerCase() === youtuberName.toLowerCase();
            });
    
            if (foundYoutuber) {
                contactEmail.value = foundYoutuber.mails;
            } else {
                contactEmail.value = "";
                alert("YouTuber not found in the database.");
            }
        }
    </script>   
</body>
</html>

